
<h1>Listing events</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Total balance</th>
      <th>Amount You Owe</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= link_to event.name, event_path(event) %></td>
        <td><%= event.description %></td>
        <td><%= number_to_currency(event.total_balance) %></td>
        <td><%= number_to_currency(event.find_user_event_balance(current_user.id).debt) %></td>
      
        <% if !event.closed %>

          <td>
          <%= button_to new_payment_url, :method => :get, :class => 'btn btn-med btn-primary' do %>
          Add Payment
          <%= hidden_field_tag :event_id, event.id %>
          <% end %>
          </td>

          <td>
            <%= button_to new_purchase_url, :method => :get, :class => 'btn btn-med btn-primary' do %>
            Add Purchase
            <%= hidden_field_tag :event_id, event.id %>
            <% end %>
          </td>

          <% if event.organizer.id == current_user.id %>
          <td>
            <%= button_to 'Close Event', close_purchase_event_path(event), :method => :get, :class => 'btn btn-med btn-primary', data: {confirm: "Are you sure? This will make users unable to add any more purchases or payments to the event!"} %>
          </td>
          <% end %>

        <% end %>

        <% if event.organizer.id == current_user.id %>
          <td>
            <%= button_to('Edit', edit_event_path(event), :class => 'btn btn-med btn-primary', :method => :get) %>
          </td>
        <% end %>

        <% if event.organizer.id == current_user.id %>
          <td>
            <%= button_to('Delete', event, :class => 'btn btn-med btn-primary', :method => :delete, data: {confirm: 'Are you sure?'} ) %>
          </td>
        <% end %>

        <!-- For debugging -->
<!--         <% event.user_event_balances.each do |ueb| %>
          <td><%= ueb.user.email %></td>          
          <td><%= ueb.debt %></td>
          <td><%= ueb.credit %></td>

          <% end %> -->
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<div>
<%= button_to('New Event', new_event_path, :class => 'btn btn-med btn-primary', :method => :get) %>
<%= button_to('See All Purchases', purchases_path, :class => 'btn btn-med btn-primary', :method => :get) %>
<%= button_to('See All Payments', payments_path, :class => 'btn btn-med btn-primary', :method => :get) %>
</div>

